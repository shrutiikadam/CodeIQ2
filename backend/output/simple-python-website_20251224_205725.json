{
  "data.config.Config": {
    "id": "data.config.Config",
    "language": "python",
    "type": "class",
    "file_path": "repos\\b9fe9237\\data\\config.py",
    "module_path": "data.config",
    "depends_on": [],
    "start_line": 4,
    "end_line": 45,
    "has_docstring": false,
    "docstring": "",
    "source_code": "class Config:\n\n    config = None\n\n    ENV_DATABASE_FILENAME = 'SPW_DATABASE_FILENAME'\n    ENV_MIGRATIONS_FILENAME = 'SPW_MIGRATIONS_FILENAME'\n    ENV_DATA_DIRECTORY = 'SPW_DATA_DIRECTORY'\n    ENV_STATIC_FILES_DIRECTORY = 'SPW_STATIC_FILES_DIRECTORY'\n    ENV_COOKIE_SECRET = 'SPW_COOKIE_SECRET'\n    ENV_PASSWORD_SECRET = 'SPW_PASSWORD_SECRET'\n    ENV_PORT = 'SPW_PORT'\n    ENV_SESSION_TTL = 'SPW_SESSION_TTL'\n\n    defaults = dict(\n        SPW_DATABASE_FILENAME='test1.db',\n        SPW_MIGRATIONS_FILEN..."
  },
  "data.config.Config.__init__": {
    "id": "data.config.Config.__init__",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\data\\config.py",
    "module_path": "data.config",
    "depends_on": [],
    "start_line": 28,
    "end_line": 45,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def __init__(self,\n                 database_filename=None,\n                 migrations_filename=None,\n                 data_directory=None,\n                 static_files_directory=None,\n                 cookie_secret=None,\n                 password_secret=None,\n                 port=None,\n                 session_ttl=None):\n        self.db_filename = database_filename or os.getenv(Config.ENV_DATABASE_FILENAME) or Config.defaults[Config.ENV_DATABASE_FILENAME]\n        self.migrations_filename = m..."
  },
  "datastore.connection.Connection": {
    "id": "datastore.connection.Connection",
    "language": "python",
    "type": "class",
    "file_path": "repos\\b9fe9237\\datastore\\connection.py",
    "module_path": "datastore.connection",
    "depends_on": [
      "datastore.connection.Connection.__exit__",
      "datastore.connection.Connection.__enter__",
      "datastore.connection.Connection.create_connection"
    ],
    "start_line": 6,
    "end_line": 31,
    "has_docstring": false,
    "docstring": "",
    "source_code": "class Connection(object):\n    def __init__(self, conf):\n        self.config = conf\n        self.database_filename = os.path.join(conf.data_directory, conf.db_filename)\n        self.db_connection = None\n\n    def __enter__(self):\n        self.db_connection = self.create_connection()\n        return self.db_connection\n\n    def __exit__(self, exc_type, exc_value, traceback):\n        if exc_value or exc_type or traceback:\n            print(exc_value)\n            print(exc_type)\n            print(trace..."
  },
  "datastore.connection.Connection.__init__": {
    "id": "datastore.connection.Connection.__init__",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\connection.py",
    "module_path": "datastore.connection",
    "depends_on": [],
    "start_line": 7,
    "end_line": 10,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def __init__(self, conf):\n        self.config = conf\n        self.database_filename = os.path.join(conf.data_directory, conf.db_filename)\n        self.db_connection = None"
  },
  "datastore.connection.Connection.__enter__": {
    "id": "datastore.connection.Connection.__enter__",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\connection.py",
    "module_path": "datastore.connection",
    "depends_on": [],
    "start_line": 12,
    "end_line": 14,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def __enter__(self):\n        self.db_connection = self.create_connection()\n        return self.db_connection"
  },
  "datastore.connection.Connection.__exit__": {
    "id": "datastore.connection.Connection.__exit__",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\connection.py",
    "module_path": "datastore.connection",
    "depends_on": [],
    "start_line": 16,
    "end_line": 22,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def __exit__(self, exc_type, exc_value, traceback):\n        if exc_value or exc_type or traceback:\n            print(exc_value)\n            print(exc_type)\n            print(traceback)\n        self.db_connection.commit()\n        self.db_connection.close()"
  },
  "datastore.connection.Connection.create_connection": {
    "id": "datastore.connection.Connection.create_connection",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\connection.py",
    "module_path": "datastore.connection",
    "depends_on": [],
    "start_line": 24,
    "end_line": 31,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def create_connection(self):\n        conn = None\n        try:\n            conn = sqlite3.connect(self.database_filename)\n            return conn\n        except Error as e:\n            print(e)\n        return conn"
  },
  "datastore.store.Store": {
    "id": "datastore.store.Store",
    "language": "python",
    "type": "class",
    "file_path": "repos\\b9fe9237\\datastore\\store.py",
    "module_path": "datastore.store",
    "depends_on": [
      "datastore.connection.Connection",
      "datastore.store.Store.execute_migration",
      "datastore.store.Store.import_test_data",
      "datastore.store.Store.check_schema_version",
      "datastore.store.Store.migrate_db"
    ],
    "start_line": 7,
    "end_line": 72,
    "has_docstring": false,
    "docstring": "",
    "source_code": "class Store:\n\n    @staticmethod\n    def migrate_db(conf):\n        schema_version = Store.check_schema_version(conf)\n\n        file = os.path.join(conf.data_directory, conf.migrations_filename)\n        data = None\n        with open(file, 'r') as f:\n            data = json.load(f)\n        if data:\n            for m in data[\"migrations\"]:\n                if m[\"version\"] > schema_version:\n                    Store.execute_migration(m, conf)\n\n    @staticmethod\n    def check_schema_version(conf):\n     ..."
  },
  "datastore.store.Store.migrate_db": {
    "id": "datastore.store.Store.migrate_db",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\store.py",
    "module_path": "datastore.store",
    "depends_on": [],
    "start_line": 10,
    "end_line": 20,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def migrate_db(conf):\n        schema_version = Store.check_schema_version(conf)\n\n        file = os.path.join(conf.data_directory, conf.migrations_filename)\n        data = None\n        with open(file, 'r') as f:\n            data = json.load(f)\n        if data:\n            for m in data[\"migrations\"]:\n                if m[\"version\"] > schema_version:\n                    Store.execute_migration(m, conf)"
  },
  "datastore.store.Store.check_schema_version": {
    "id": "datastore.store.Store.check_schema_version",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\store.py",
    "module_path": "datastore.store",
    "depends_on": [
      "datastore.connection.Connection"
    ],
    "start_line": 23,
    "end_line": 35,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def check_schema_version(conf):\n        schema_version = 0\n        with Connection(conf) as db_connection:\n            try:\n                c = db_connection.cursor()\n                sql = 'select max(version) from migrations;'\n                row = c.execute(sql).fetchone()\n                if row:\n                    schema_version = row[0]\n            except Error as err:\n                print(err)\n        print(f'max schema version = {schema_version}')\n        return schema_version"
  },
  "datastore.store.Store.execute_migration": {
    "id": "datastore.store.Store.execute_migration",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\store.py",
    "module_path": "datastore.store",
    "depends_on": [
      "datastore.connection.Connection"
    ],
    "start_line": 38,
    "end_line": 49,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def execute_migration(migration, conf):\n        with Connection(conf) as db_connection:\n            try:\n                c = db_connection.cursor()\n                sql = migration[\"sql\"]\n                print(sql)\n                c.execute(sql)\n                sql = f'insert into migrations values (\\'{migration[\"version\"]}\\', \\'{migration[\"comment\"]}\\', CURRENT_TIMESTAMP);'\n                print(sql)\n                c.execute(sql)\n            except Error as err:\n                print(err)"
  },
  "datastore.store.Store.import_test_data": {
    "id": "datastore.store.Store.import_test_data",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\datastore\\store.py",
    "module_path": "datastore.store",
    "depends_on": [
      "datastore.connection.Connection"
    ],
    "start_line": 52,
    "end_line": 72,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def import_test_data(conf, table, json_data_file):\n        print(f'importing data to {table} from {json_data_file}')\n        data = None\n        with open(json_data_file, 'r') as f:\n            data = json.load(f)\n        if data:\n            with Connection(conf) as db_connection:\n                try:\n                    c = db_connection.cursor()\n                    for item in data:\n                        columns = list(item.keys())\n                        values = []\n                       ..."
  },
  "datastore.things.get_all_things": {
    "id": "datastore.things.get_all_things",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\things.py",
    "module_path": "datastore.things",
    "depends_on": [],
    "start_line": 1,
    "end_line": 7,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def get_all_things(db):\n    rows = db.execute('SELECT * from things').fetchall()\n    things = []\n    if rows and len(rows) > 0:\n        for row in rows:\n            things.append(dict(row))\n    return things"
  },
  "datastore.users.calculate_password_hash": {
    "id": "datastore.users.calculate_password_hash",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [],
    "start_line": 4,
    "end_line": 10,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def calculate_password_hash(config, password):\n    secret = config.password_secret\n    module = hashlib.md5()\n    string = f'{password}+{secret}'\n    module.update(bytes(string, encoding='utf-8'))\n    password_hash = module.hexdigest()\n    return password_hash"
  },
  "datastore.users.create_user": {
    "id": "datastore.users.create_user",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [
      "datastore.users.calculate_password_hash"
    ],
    "start_line": 13,
    "end_line": 29,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def create_user(db, config, firstname, lastname, username, password):\n    password_hash = calculate_password_hash(config, password)\n    cursor = db.execute(\n        'INSERT INTO users(firstname, lastname, created_at, is_admin) values(?, ?, CURRENT_TIMESTAMP, 0);',\n        (firstname, lastname))\n    row_count1 = cursor.rowcount\n    user_id = cursor.lastrowid\n\n    if row_count1 > 0:\n        row_count2 = db.execute(\n            \"INSERT INTO auth_methods(user_id, username, password, type) values(?, ..."
  },
  "datastore.users.check_login": {
    "id": "datastore.users.check_login",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [
      "datastore.users.calculate_password_hash"
    ],
    "start_line": 32,
    "end_line": 39,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def check_login(db, config, username, password):\n    password_hash = calculate_password_hash(config, password)\n    row = db.execute(\n        'SELECT user_id from auth_methods where username=? and password=? and type=\\'USERNAME_AND_PASSWORD\\'',\n        (username, password_hash)).fetchone()\n    if row:\n        return int(row['user_id'])\n    return -1"
  },
  "datastore.users.check_admin": {
    "id": "datastore.users.check_admin",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [
      "datastore.users.user_by_username"
    ],
    "start_line": 42,
    "end_line": 47,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def check_admin(db, username):\n    user = user_by_username(db, username)\n    if user:\n        return bool(user[\"is_admin\"])\n    else:\n        return False"
  },
  "datastore.users.get_user_by_id": {
    "id": "datastore.users.get_user_by_id",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [],
    "start_line": 50,
    "end_line": 55,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def get_user_by_id(db, user_id):\n    row = db.execute('SELECT * from users where id=?', (user_id,)).fetchone()\n    if row:\n        user = dict(row)\n        return user\n    return None"
  },
  "datastore.users.user_by_username": {
    "id": "datastore.users.user_by_username",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [
      "datastore.users.user_id_by_username",
      "datastore.users.get_user_by_id"
    ],
    "start_line": 58,
    "end_line": 60,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def user_by_username(db, username):\n    user_id = user_id_by_username(db, username)\n    return get_user_by_id(db, user_id)"
  },
  "datastore.users.user_id_by_username": {
    "id": "datastore.users.user_id_by_username",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\datastore\\users.py",
    "module_path": "datastore.users",
    "depends_on": [],
    "start_line": 63,
    "end_line": 68,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def user_id_by_username(db, username):\n    row = db.execute(\"SELECT user_id from auth_methods where username=? and type='USERNAME_AND_PASSWORD'\", (username,)).fetchone()\n    if row:\n        user_id = int(row[\"user_id\"])\n        return user_id\n    return None"
  },
  "test.import_test_data.import_users": {
    "id": "test.import_test_data.import_users",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\test\\import_test_data.py",
    "module_path": "test.import_test_data",
    "depends_on": [
      "test.import_test_data.test_data_directory",
      "datastore.store.Store",
      "data.config.Config"
    ],
    "start_line": 8,
    "end_line": 10,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def import_users(file_name='users.json'):\n    users_file = os.path.join(test_data_directory, file_name)\n    Store.import_test_data(Config.config, 'users', users_file)"
  },
  "test.import_test_data.import_authdata": {
    "id": "test.import_test_data.import_authdata",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\test\\import_test_data.py",
    "module_path": "test.import_test_data",
    "depends_on": [
      "test.import_test_data.test_data_directory",
      "datastore.store.Store",
      "data.config.Config"
    ],
    "start_line": 13,
    "end_line": 15,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def import_authdata(file_name='authdata.json'):\n    authdata_file = os.path.join(test_data_directory, file_name)\n    Store.import_test_data(Config.config, 'auth_methods', authdata_file)"
  },
  "test.import_test_data.import_things": {
    "id": "test.import_test_data.import_things",
    "language": "python",
    "type": "function",
    "file_path": "repos\\b9fe9237\\test\\import_test_data.py",
    "module_path": "test.import_test_data",
    "depends_on": [
      "test.import_test_data.test_data_directory",
      "datastore.store.Store",
      "data.config.Config"
    ],
    "start_line": 18,
    "end_line": 20,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def import_things(file_name='things.json'):\n    things_file = os.path.join(test_data_directory, file_name)\n    Store.import_test_data(Config.config, 'things', things_file)"
  },
  "test.datastore.users.UsersTest": {
    "id": "test.datastore.users.UsersTest",
    "language": "python",
    "type": "class",
    "file_path": "repos\\b9fe9237\\test\\datastore\\users.py",
    "module_path": "test.datastore.users",
    "depends_on": [
      "test.datastore.users.UsersTest.test_password_hash_stays_same",
      "data.config.Config",
      "test.datastore.users.UsersTest.test_generate_hash",
      "test.datastore.users.UsersTest.test_password_hashes_are_different",
      "test.datastore.users.UsersTest.setUp"
    ],
    "start_line": 6,
    "end_line": 26,
    "has_docstring": false,
    "docstring": "",
    "source_code": "class UsersTest(unittest.TestCase):\n\n    def setUp(self) -> None:\n        self.config = Config(password_secret='really-long-password-secret-for-generating-a-hash')\n        self.correct_hash = 'aafef08cd8566e96c04898c3db3e5559'\n        self.correct_password = 'password'\n        self.wrong_password = 'password1'\n\n    def test_password_hash_stays_same(self):\n        assert self.correct_hash == users.calculate_password_hash(self.config, self.correct_password)\n        assert self.correct_hash == user..."
  },
  "test.datastore.users.UsersTest.setUp": {
    "id": "test.datastore.users.UsersTest.setUp",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\test\\datastore\\users.py",
    "module_path": "test.datastore.users",
    "depends_on": [
      "data.config.Config"
    ],
    "start_line": 8,
    "end_line": 12,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def setUp(self) -> None:\n        self.config = Config(password_secret='really-long-password-secret-for-generating-a-hash')\n        self.correct_hash = 'aafef08cd8566e96c04898c3db3e5559'\n        self.correct_password = 'password'\n        self.wrong_password = 'password1'"
  },
  "test.datastore.users.UsersTest.test_password_hash_stays_same": {
    "id": "test.datastore.users.UsersTest.test_password_hash_stays_same",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\test\\datastore\\users.py",
    "module_path": "test.datastore.users",
    "depends_on": [],
    "start_line": 14,
    "end_line": 16,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def test_password_hash_stays_same(self):\n        assert self.correct_hash == users.calculate_password_hash(self.config, self.correct_password)\n        assert self.correct_hash == users.calculate_password_hash(self.config, self.correct_password)"
  },
  "test.datastore.users.UsersTest.test_password_hashes_are_different": {
    "id": "test.datastore.users.UsersTest.test_password_hashes_are_different",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\test\\datastore\\users.py",
    "module_path": "test.datastore.users",
    "depends_on": [],
    "start_line": 18,
    "end_line": 19,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def test_password_hashes_are_different(self):\n        assert users.calculate_password_hash(self.config, self.correct_password) != users.calculate_password_hash(self.config, self.wrong_password)"
  },
  "test.datastore.users.UsersTest.test_generate_hash": {
    "id": "test.datastore.users.UsersTest.test_generate_hash",
    "language": "python",
    "type": "method",
    "file_path": "repos\\b9fe9237\\test\\datastore\\users.py",
    "module_path": "test.datastore.users",
    "depends_on": [
      "data.config.Config"
    ],
    "start_line": 21,
    "end_line": 26,
    "has_docstring": false,
    "docstring": "",
    "source_code": "def test_generate_hash(self):\n        password = 'admin-password'\n        Config()\n        hash = users.calculate_password_hash(Config.config, password)\n        print(f'Generated a MD5 hash for \"{password}\" => {hash}')\n        assert True"
  }
}